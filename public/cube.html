<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>3D Cube with 2 Iframes (three.js R180) - fixed imports</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    html,body{height:100%;margin:0;overflow:hidden;background:#111}
    #container{width:100%;height:100%;position:relative}
    canvas.webgl{position:absolute;left:0;top:0;display:block}
    .css3d{position:absolute;left:0;top:0;pointer-events:none}
    .iframe-face{
      width:600px; height:360px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
      border: 2px solid rgba(255,255,255,0.06);
      background: #000;
      pointer-events:auto;
    }
    .iframe-face iframe{width:100%;height:100%;border:0}
    .fallback {
      color:#fff; font-size:13px; padding:6px 10px; background:rgba(0,0,0,0.6);
      border-radius:6px; display:inline-block; margin-top:6px;
    }
    #hint {
      position: absolute; left: 12px; top: 12px; z-index:9999;
      color:#ddd; font-family:system-ui,Segoe UI,Roboto; font-size:13px;
      background: rgba(0,0,0,0.35); padding:8px 10px; border-radius:8px;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="hint">Drag rotate / scroll to zoom. Hover iframe to interact (Orbit disabled while over iframe).</div>
    <div id="three-root"></div>
  </div>

  <script type="module">
  // --- IMPORTANT: use full CDN module URLs (no bare specifiers) ---
  import * as THREE from 'https://unpkg.com/three@0.180.0/build/three.module.js';
  import { OrbitControls } from 'https://unpkg.com/three@0.180.0/examples/jsm/controls/OrbitControls.js';
  import { CSS3DRenderer, CSS3DObject } from 'https://unpkg.com/three@0.180.0/examples/jsm/renderers/CSS3DRenderer.js';

  const URL_A = 'https://goonee.netlify.app/';
  const URL_B = 'https://goorum.netlify.app/';
  const CUBE_SIZE = 3;

  const container = document.getElementById('three-root');
  container.style.width = '100%';
  container.style.height = '100%';
  container.style.position = 'absolute';
  container.style.left = '0';
  container.style.top = '0';

  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x111111);

  const camera = new THREE.PerspectiveCamera(50, window.innerWidth/window.innerHeight, 0.1, 1000);
  camera.position.set(4, 2.5, 6);

  const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
  renderer.setPixelRatio(window.devicePixelRatio || 1);
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.domElement.classList.add('webgl');
  container.appendChild(renderer.domElement);

  const cssRenderer = new CSS3DRenderer();
  cssRenderer.setSize(window.innerWidth, window.innerHeight);
  cssRenderer.domElement.style.position = 'absolute';
  cssRenderer.domElement.style.top = 0;
  cssRenderer.domElement.style.left = 0;
  cssRenderer.domElement.classList.add('css3d');
  container.appendChild(cssRenderer.domElement);

  const ambient = new THREE.AmbientLight(0xffffff, 0.6); scene.add(ambient);
  const dir = new THREE.DirectionalLight(0xffffff, 0.6); dir.position.set(5,6,4); scene.add(dir);

  const geo = new THREE.BoxGeometry(CUBE_SIZE, CUBE_SIZE, CUBE_SIZE);
  const mats = [
    new THREE.MeshStandardMaterial({ color: 0x2a6fdb }),
    new THREE.MeshStandardMaterial({ color: 0x2a6fdb }),
    new THREE.MeshStandardMaterial({ color: 0x3dbf7f }),
    new THREE.MeshStandardMaterial({ color: 0x3dbf7f }),
    new THREE.MeshStandardMaterial({ color: 0xffaa33 }),
    new THREE.MeshStandardMaterial({ color: 0xffaa33 }),
  ];
  const cube = new THREE.Mesh(geo, mats);
  cube.castShadow = true;
  cube.receiveShadow = true;
  scene.add(cube);

  // Use cssRenderer.domElement for OrbitControls to allow pointer interactions with CSS layer
  const controls = new OrbitControls(camera, cssRenderer.domElement);
  controls.enableDamping = true;
  controls.target.set(0,0,0);

  function makeIframeElement(url, width=600, height=360) {
    const wrapper = document.createElement('div');
    wrapper.className = 'iframe-face';
    wrapper.style.width = width + 'px';
    wrapper.style.height = height + 'px';
    const iframe = document.createElement('iframe');
    iframe.src = url;
    iframe.setAttribute('allowfullscreen', '');
    iframe.style.pointerEvents = 'auto';
    iframe.style.background = '#000';
    wrapper.appendChild(iframe);

    const fallback = document.createElement('div');
    fallback.className = 'fallback';
    fallback.textContent = 'If the site blocks embedding, click to open in new tab';
    fallback.style.display = 'none';
    fallback.style.cursor = 'pointer';
    fallback.onclick = () => window.open(url, '_blank', 'noopener,noreferrer');
    wrapper.appendChild(fallback);

    let loaded = false;
    iframe.addEventListener('load', () => {
      loaded = true;
      fallback.style.display = 'none';
    });
    setTimeout(() => {
      if (!loaded) fallback.style.display = 'inline-block';
    }, 4000);

    wrapper.addEventListener('mouseenter', () => controls.enabled = false);
    wrapper.addEventListener('mouseleave', () => controls.enabled = true);

    return wrapper;
  }

  const half = CUBE_SIZE / 2;
  const elementA = makeIframeElement(URL_A, 600, 360);
  const cssObjA = new CSS3DObject(elementA);
  cssObjA.position.set(0, 0, half + 0.001);
  const pxToUnit = 0.01; // ปรับถ้าขนาดไม่พอดี
  cssObjA.scale.set(pxToUnit, pxToUnit, pxToUnit);
  scene.add(cssObjA);

  const elementB = makeIframeElement(URL_B, 600, 360);
  const cssObjB = new CSS3DObject(elementB);
  cssObjB.position.set(half + 0.001, 0, 0);
  cssObjB.rotation.y = - Math.PI / 2;
  cssObjB.scale.set(pxToUnit, pxToUnit, pxToUnit);
  scene.add(cssObjB);

  const frameMat = new THREE.MeshBasicMaterial({ color: 0xffffff, side: THREE.DoubleSide, transparent:true, opacity:0.06 });
  const faceGeo = new THREE.PlaneGeometry(CUBE_SIZE * 0.98, CUBE_SIZE * 0.58);
  const frameA = new THREE.Mesh(faceGeo, frameMat);
  frameA.position.copy(cssObjA.position);
  frameA.rotation.copy(cssObjA.rotation);
  scene.add(frameA);
  const frameB = new THREE.Mesh(faceGeo, frameMat);
  frameB.position.copy(cssObjB.position);
  frameB.rotation.copy(cssObjB.rotation);
  scene.add(frameB);

  window.addEventListener('resize', onWindowResize, { passive: true });
  function onWindowResize() {
    const w = window.innerWidth, h = window.innerHeight;
    camera.aspect = w / h;
    camera.updateProjectionMatrix();
    renderer.setSize(w,h);
    cssRenderer.setSize(w,h);
  }

  function animate() {
    requestAnimationFrame(animate);
    controls.update();
    renderer.render(scene, camera);
    cssRenderer.render(scene, camera);
  }
  animate();

  console.log('Cube with iframes ready. If iframe content doesn\'t appear the target site may block embedding (X-Frame-Options).');

  </script>
</body>
</html>
